<app-navbar></app-navbar>

<main class="calendar-wrapper">
  <div class="calendar-header">
    <button class="nav-btn" (click)="prevMonth()" aria-label="Mes anterior">&#9664;</button>

    <div class="selectors">
      <select [(ngModel)]="selectedMonth" (ngModelChange)="onMonthChange($event)">
        <option *ngFor="let m of months; index as i" [value]="i">{{ m }}</option>
      </select>

      <select [(ngModel)]="selectedYear" (ngModelChange)="onYearChange($event)">
        <option *ngFor="let y of availableYears" [value]="y">{{ y }}</option>
      </select>
    </div>

    <button class="nav-btn" (click)="nextMonth()" aria-label="Mes siguiente">&#9654;</button>
  </div>

  <div *ngIf="error" class="alert">Ocurrió un error al cargar las tareas.</div>
  <div *ngIf="loading" class="loading">Cargando...</div>

  <section *ngIf="!loading && !error" class="calendar-grid">
    <div class="week-header">Lun</div>
    <div class="week-header">Mar</div>
    <div class="week-header">Mié</div>
    <div class="week-header">Jue</div>
    <div class="week-header">Vie</div>
    <div class="week-header">Sáb</div>
    <div class="week-header">Dom</div>

    <div *ngFor="let cell of grid; index as i" class="day-cell" [class.is-empty]="!cell.date">
      <div class="day-number" *ngIf="cell.date">{{ cell.date.getDate() }}</div>

      <ul class="tasks" *ngIf="cell.date && cell.titles.length">
        <li *ngFor="let title of (cell.titles | slice:0:2)" class="task-title" title="{{ title }}">{{ title }}</li>
      </ul>

      <button
        *ngIf="cell.date && cell.titles.length > 2"
        type="button"
        class="more-btn"
        (click)="toggleDropdown(i)"
        [attr.aria-expanded]="cell.showAll === true">
        ▼ {{ cell.titles.length - 2 }}
      </button>

      <div class="dropdown" *ngIf="cell.showAll === true">
        <ul>
          <li *ngFor="let title of (cell.titles | slice:2)" class="dropdown-item" title="{{ title }}">{{ title }}</li>
        </ul>
      </div>
    </div>
  </section>
</main>


